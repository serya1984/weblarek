# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

#### Данные

При разборе проекта были установлены две сущности (продукт и пользователь) имеющие следующие данны.

interface IProduct {
`id: string;` - идентификационный номер карточки товара
`title: string` - название товара
`image: string` - кортинка товара
`price: numder | null` - цена товара
`category: string` - категория товара
`description: string` - описание товар
}

interface IBuser {
`payment: IPayment;` - выбор способа оплаты
`email: string;` - поста покупателя
`phone: string;` - телефон покупателя
`addres: string;` - адрес доставки товара
}

interface IBuserError {
`buyerPayment: string;` - способа оплаты
`buyerEmail: string;` - Email покупателя
`buyerPhone: string;` - телефон покупателя
`buyerAddress: string;`- адрес доставки товара
}

export interface ICreateOrder {
`payment: TPayment;` - способ оплаты
`email: string;` - Email покупателя
`phone: string;` - телефон покупателя
`address: string;` - адрес покупателя
`total: number;` - общая стомость заказа
`items: string[];` - массив товаров
}

export interface IOrderComplite {
`id: string;` - id заказа
`total: number;` - общая стоимость заказа
}

### Модели данных

#### Класс Products

Отвечает за хранение товаров которые можно купить в приложении
В конструктор передаёться брокер событий `constructor(protected events: IEvents) {}`

Поля класса
`products: IProduct[]` - поле хранит массив продуктов
`product: IProduct` - поле хранит товар выбраный для подробного отображения

Методы класса:

`setItems(items: IProduct[])` - сохраняет массив товаров который принимает как аргумент
`getItems(): IProduct[]>` - предназначен для получения массива всех товаров
`getItem(id: string)` - предназначен для получения одного товара по его id
`setSavedItem(id: string)` - предназначен для сохранения одного товара для подробного отображения
`getSavedItem(): IProduct | undefined` - предназначен для получения товара для его подробного отображения

#### Класс Basket
 `constructor(protected events: IEvents) {}` - принимает в конструктор брокер событий

Хранит массив выбранных покупателем товаров для покупки:
`itemsProduct: IProduct[]`

Методы класса:
`getItemsProducts(): IProduct[]` - получение массива товаров которые находяться к корзине
`addProduct(product: IProduct)` - добавление выбранного товара в массив продуктов
`removeProduct(id: string)` - удаление выбранного товара из массива продустов
`clearBasket()` - очистка корзины
`getTotalPrice(): number `- получение стоимости всех товаров в корзине
`getProductsCount()` - получение колличества товаров в козине
`hasProduct(id: string): boolean` - проверка наличия товара в корзине

#### Класс Buyer

`constructor(protected events: IEvents) {}` - принимает в конструктор брокер событий

Поля класса:
`buyerPayment: TPayment | string = "";` - вид оплаты
`buyerEmail: string = "";` - email покупателя
`buyerPhone: string = "";` - телефон покупателя
`buyerAddress: string = ""` - адрес доставки

Методы класса:

`setPayment(payment: TPayment)` - сохранить выбранный покупателем вид оплаты
`setEmail(email: string)` - сохраняет email покупателя
`setPhone(phone: string)` - сохраняет номер телефона покупателя
`setAddress(address: string)` - сохраняет адрес доставки
`getData(): IBuser` - получение всех данных покупателя
`validate(): IBuserError` - проверяет данные покупателя
`clearDataBuyer()` - очистка данных покупателя

### Слой коммуникации

#### Класс DataApi 

Принимает в конструктор объект `constructor(apiService: IApi)`
Поле класса:
`apiService: IApi`

Методы класса:

`getProducts(): Promise<IProduct[]>` - получение данных с сервера
`createOrder(order: ICreateOrder): Promise<IOrderComplite>` отправка данных заказа на сервер

### Отображение 

#### класс Header extends Component(IheaderData) 

`constructor(container: HTMLElement, protected events: IEvents)` принимает в конструктор контеинер и событие

Поля класса: 
`protected headerCounter: HTMLElement` - html элемент отображающий количество товаров в корзине
`protected headerButton: HTMLButtonElement` - кнопка открывающая козину

Методы класса: 
`set counter(value: number)` - сеттер который меняет значение колличества товаров в козине

#### класс Gallery extends Component(IGalleryData)
`constructor(container: HTMLElement)` - принимает в конструктор котейнер

Поля класса: 
`protected catalogElement: HTMLElement` - элемент каталога товаров

Методы класса: 
`set catalog(items: HTMLElement[])` - сеттер который добавляет элементы каталога в каталог

#### класс ModalWindow extends Component(IModalWindow) 
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контеинер и событие

Поля класса: 
`modalContent: HTMLElement` - контейнер модального окна в котором отображаеться информация о товаре 
`modalCloseButton: HTMLButtonelement` - кнопка закрытия модального окна

Методы класса: 
`set content(content: HTMLElement)` - сеттер который добавляет контент в модальное окно
`openModalWindow(): void` - метод окрытия модального окна
`closeModalWindow(): void` - метод закрытия модального окна

#### класс CardView extends Component(ICardView)
`constructor(container: HTMLElement)` - принимает в конструктор контеинер

Поля класса: 
`cardTitle: HTMLElement` - элемент разметки с названием товара в карточке
`cardPrice: HTMLElement` - элемент разметки со стоимостью товара

Методы класса: 
`set title(value: string)` - сеттер который добавляет название товара в соответсевующий html элемент
`set price(value: number)` - сеттер который добавляет стоимость в соответствующий html элемент

#### класс GalleryCardView extends CardView(IGalleryView) 
`constructor(container: HTMLElement, protected actions?: ICardActions)` - принимает в конструктор контеинер и объект actions

Поля класса: 
`cardCategory: HTMLElement` - элемент разметки с категорией товара
`cardImage: HTMLImagelement` - элемент разметки с картинкой товара

Методы класса:
`set category(value: string)` - сеттер который добавляет значение в элемент разметки с категорией товара
`set image(value: string)` - сеттер который добавляет в разметку адрес картики товара   

#### класс ModalCardView extends CardView(IModalCardView)
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса:
`cardCategory: HTMLElement` - элемент разметки с категорией товара
`cardImage: HTMLImagelement` - элемент разметки с картинкой товара
`cardDescription: HTMLElement` - элемент разметки с описанием товара
`addButton: HTMLElement` - кнопка в модальном окне

Методы класса: 
`set category(value: string)` - сеттер который добавляет значение в элемент разметки с категорией товара
`set image(value: string)` - сеттер который добавляет в разметку адрес картики товара  
`set description(value: string)` - сеттер который добавляет значение с описанием товара в элемент разметки
`set activeButton(value: boolean)` - делает кнопку не активной
`set buttonText(value: string` - добавляет текст кнопке
`setButtonListener(actions: ICardActions)` - метод который принимает объект actions при клике по кнопке `addButton`

#### класс BasketView extends CardView(IBasketCardView) 
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса: 
`basketList: HTMLElement;` - элемент списка товаров вкорзине
`basketTotalPrice: HTMLElement;` - элемент разметки с общей стоимостью товара
`basketButton: HTMLButtonElement` - кнопка удаления выбранного товара из корзины

Методы класса: 
`set list(value: HTMLElement[])` - добавляет элемент списка товаров в список товаров в корзине
`set totalPrice(value: number)` - добавляет значение общей стоимости товаров в корзине в элемент разметки
`set activeButton(value: boolean)` - делае кнопку не активной

#### класс BasketCardView extends Component(IBasketView)
`constructor(container: HTMLElement, protected actions?: ICardActions)` - Принимает в конструктор контейнер и объект actions

Поля класса:
`basketIndex: HTMLElement;` - элемент разметки с индексом товара в корзине
`basketDeleteButton: HTMLButtonElement` - кнопка удаления товара из корзины

Методы класса:
`set index(value: number)` - добавляет индекс товара в корзине в элемент разметки 


#### класс Form extends Component(IForm) 
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса: 
`formError: HTMLElement` - элмент разметки с текстом ошибки в форме
`formButton: HTMLButtonElement;` - элемент разметки кнопки в форме

Методы класса:
`set error(value: string)` - добавляет текст ошибки в элемент разметки
`set activeButton(value: boolean)` - делает кнопку не активной


#### класс FormOrder extends Form(IOrderForm)
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса: 
`formCardButton: HTMLButtonElement` - кнопка оплаты товара картой
`formCashButton: HTMLButtonElement` - кнопка оплаты товара при получении
`formInputAddres: HTMLInputElement` - строка ввода адреса доставки

Методы класса:
`set addres(value: string)` - добавляет значение адреса доставки в элемент разметки
`set payment(value: TPayment)` - делает активной выбранную кнопку способа оплаты

#### класс FormContact extends Form(IContactForm)
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса:
`formInputEmail: HTMLInputElement` - строка ввода email покупателя
`formInputPhone: HTMLInputElement` - сетрока ввода телефона покупателя

Методы класса: 
`set email(value: string)` - сеттер добавляет значение email в элемент разметки
`set phone(value: string)` -  сеттер добавляет значение номера телефона в элемент разметки


#### класс OrderSuccess extends Component(IOrderSuccess)
`constructor(container: HTMLElement, protected events: IEvents)` - принимает в конструктор контейнер и брокер событий

Поля класса: 
`descriptionTotalPriceOrder: HTMLElement;` - общая стоимость заказа
`battonSuccessOrder` - кнопка завершения оформления заказа

Методы класса:
`set totalPrice(value: string)` - сеттер добавляет строку с общую стоимость заказа после оформления 

##### События 

`value:changed` - событие изменения количества товаров в корзине
`open:basket` - событие открытия корзины-
`card:select` - событие выбора карточки 
`product:select` - событие выбора товара-
`modalCardView:click` - cсобытие клика по кнопке в карточке товара в модальном окне
`product:unselect` - событие отказа от товара-
`itemsProducts:changed` - событие изменения данных колличества товаров в козине-
`product:save` - событие сохранения товара для отображения-
`close:window` - событие закрытия модального окна-
`product:delete` - событие удаления товара из корзины-
`checkout` -  событие оформления выбраных товаров-
`paymenеMethod:card` - событие выбора метода оплаты картой-
`paymenеMethod:cash` - событие выбора метода оплаты при получении -
`order:submit` - событие перехода к форме № 2-
`inputAddressValue:changed` - событие изменения значения в инпуте адрес-
`inputEmail:changed` - событие изменения значения в инпуте Email-
`inputPhone:changed` - событие изменения значения в инпуте телефон-
`buyer:changed-data` - событие изменения данных покупателя при оформлении-
`contacts:submit` - событие отправки данных покупателя -
`order:completed` - событие окончания оформления заказа -
`items:changed` - событие изменения массива данных

### Призентор

Код написан в основном скримте приложения в main.ts

Получив данные с сервера массив с данными товаров сохраняеться в моели данным после чего отрисовываеться на странице. Обработав событие выбранной карточки сохраняет данные в модели данных. Функция getModelCardContent() отвечает за отрисовку кнопок в карточке модального окна, меняя состояние и надписи на кнопке карточки товара на 'Купить', 'Удалить из корзины', 'Недоступно' и делает кнопку недоступно если у товара нет цены. 
  При обработке события изменения данных в корзине проверяеться есть ли товар в корзине или нет, после чего, в зависимости от наличия товара отрисовываеться карточка товар с указанием соответствующей ндписью, или состоянием кнопки. Обработав событие сохранения данных в модели данных отрисовывается карточка выюранного товара в модальном окне, при условии его наличия. 
  При обработке события закрытия модального окна модальное окно закрываеться  при нажатии на кнопку закрытия или на оверлей вне модального окна.
При обработке события открытия корзины открываеться модально окно с отрисованным шаблоном корзины.
При обработке события выбора продакта сохранённый для отрисовки в модели данных продукт при условии его наличия добавляеться в модель данных корзины при клике на кнопке 'Купить'. Модальное окно закрываеться.
Если товар уже добавлен в козину, обработав событие удаления товара, товар удаляеться из козины кнопкой в карточке товара. Модальное окно закрываеться.
 При обработке события изменения данных в массиве корзины, сформировав обект данных отрисовываем корзину при открытии в модальном окне.
 Обработав событие удаления товара удалеться выбранный товар из корзины. 
 В третий раз обработав событие изменения данных в массиве товаров в корзине, при наличии товаров в корзине кнопка активируеться, при отсутствии становиться не активной.
 При обработке события оформления заказа при нажатии на кнопку оформить отрываеться первая форма, в которой выбираеться способ оплаты и адрес доставки товара.
 При обработке события выбора способа оплаты картой в модель данных добавляеться значение оплаты картой.
 При обработке события оплаты при получении в модель данных добавляеться значение оплаты при получении.
 При обработке события при котором покупатель решил изменить заказ данные которые пользователь ввёл в форму ранее сохраняються.
 Обработав события изменения значения в инпуте сохраняеться значение введённое в строку ввода и сохраняеться в объекте данных покупателя.
 Обработав событие клика по кнопке в форме открываеться вторая форма с имеилом и телефоном для ввода покупателем.
 Обработав событие ввода данных в поле инпута имейла покупателя данные сохраняються в объекте данных покупателя.
 При обработке события ввода данных в поле инпута с данными телефона, данные сохраняються в объекте данных покупателя.
 При обработке события при котором покупатель решает изменить заказ при заполнении второй формы введённые данные сохраняються.
 При обработке события клика по кнопке отправить происходит отправка данных покупателя и заказа на сервер. 
 При обработке события окончания заказа в модальное окно выводиться данные с общей стоимостью товара, очищаються данные о заказе и покупателе.







